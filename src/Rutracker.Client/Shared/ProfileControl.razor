@inject IUriHelper UriHelper
@inject IMatToaster MatToaster
@inject AppState AppState

<AuthorizeView>
    <Authorized>
        @if (Model != null)
        {
            <div class="drawer-profile">
                <MatIconButton Icon="@MatIconNames.Account_circle" Link="@ProfileLink"></MatIconButton>
                <span class="miniHover"><b><a href="@ProfileLink">@Model.UserName</a></b></span>
            </div>
        }
    </Authorized>
</AuthorizeView>

@functions
{
    [CascadingParameter] Task<AuthenticationState> AuthenticationStateTask { get; set; }

    UserViewModel Model { get; set; }
    string ProfileLink => "/account/profile";

    protected override async Task OnInitAsync()
    {
        if ((await AuthenticationStateTask).User.Identity.IsAuthenticated)
        {
            try
            {
                Model = await AppState.UserDetails();
            }
            catch (Exception ex)
            {
                MatToaster.Add(ex.Message, MatToastType.Warning, "Failed to get user profile.");
            }
        }
    }
}