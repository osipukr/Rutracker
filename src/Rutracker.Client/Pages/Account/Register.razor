@layout LoginLayout
@inject AppState AppState
@inject IUriHelper UriHelper
@inject IMatToaster MatToaster

@page "/account/register"

<MatCard>
    <EditForm Model="@RegisterModel" OnValidSubmit="@OnValidSubmitClicked">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <fieldset>
            <div class="form-group">
                <MatTextField @bind-value="@RegisterModel.UserName"
                              Label="User Name"
                              Icon="@MatIconNames.Person"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true" />
            </div>

            <div class="form-group">
                <MatTextField @bind-value="@RegisterModel.Email"
                              Label="Email"
                              Icon="@MatIconNames.Mail_outline"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true" />
            </div>

            <div class="form-group">
                <MatTextField @bind-value="@RegisterModel.Password"
                              Label="Password"
                              Icon="@MatIconNames.Lock_open"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true"
                              Type="password" />
            </div>

            <div class="form-group">
                <MatTextField @bind-value="@RegisterModel.ConfirmPassword"
                              Label="Password Confirmation"
                              Icon="@MatIconNames.Lock_open"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true"
                              Type="password" />
            </div>

            <div class="form-group d-flex justify-content-end">
                <MatButton Type="submit" Raised="true" Label="Create account" />
            </div>

            <hr />

            <MatButton Link="@LoginLink" Outlined="true" Label="Login to account" />
        </fieldset>
    </EditForm>
</MatCard>

@code
{
    private RegisterViewModel RegisterModel { get; set; } = new RegisterViewModel();

    private const string LoginLink = "account/login";

    private async Task OnValidSubmitClicked()
    {
        try
        {
            await AppState.Register(RegisterModel);

            UriHelper.NavigateTo("/", forceLoad: true);
        }
        catch (Exception ex)
        {
            MatToaster.Add(ex.Message, MatToastType.Warning, "Error creating account");
        }
    }
}