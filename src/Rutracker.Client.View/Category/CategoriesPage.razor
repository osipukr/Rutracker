@page "/categories"

@inject ICategoryService CategoryService
@inject IMatToaster ToastService

<div class="Categories-Root">
    @if (_errorModel.IsError)
    {
        <ErrorCard>
            Cannot be load category list <br />

            @_errorModel.Message
        </ErrorCard>
    }
    else
    {
        <AuthorizeView Policy="@Policies.IsAdmin">
            <Authorized>
                <CategoriesToolbar OnImportClicked="@OnImportEventHandler"
                                   OnExportClicked="@OnExportEventHandler"
                                   OnAddClicked="@OnAddEventHandler" />
            </Authorized>
        </AuthorizeView>

        @if (_categories == null)
        {
            <ProgressCard />
        }
        else if (!_categories.Any())
        {
            <EmptyCard>
                Categories list is empty
            </EmptyCard>
        }
        else
        {
            <MatAccordion Class="Categories-List-Root" HideToggle="false" Multi="false">
                @foreach (var category in _categories)
                {
                    <CategoryCard Category="@category" @key="@category" />
                }
            </MatAccordion>
        }
    }
</div>


@code
{
    private List<CategoryView> _categories;
    private readonly ErrorModel _errorModel = ErrorModel.Create();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _categories = await CategoryService.ListAsync();
        }
        catch (Exception exception)
        {
            _errorModel.HandlerException(exception);
        }
    }

    private void OnImportEventHandler(EventArgs e)
    {
    }

    private void OnExportEventHandler(EventArgs e)
    {
    }

    private void OnAddEventHandler(EventArgs e)
    {
    }
}