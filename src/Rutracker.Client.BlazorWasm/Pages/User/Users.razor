@inject IUserService UserService

@page "/users"

<Page Action="@LoadAction" Errors="@Errors">
    @if (UsersPagination != null)
    {
        <ListItemsHeader Title="Total users" TotalItems="@UsersPagination.TotalItems" />

        <UserList Items="@UsersPagination.Items" />

        @if (UsersPagination.TotalPages > 1)
        {
            <Pagination Page="@Page"
                        PageSize="@PageSize"
                        TotalPages="@UsersPagination.TotalPages"
                        TotalItems="@UsersPagination.TotalItems"
                        OnPageChange="@PageChanged" />
        }
    }
</Page>

@code
{
    private PaginationResult<UserViewModel> UsersPagination { get; set; }
    private int Page { get; set; } = 1;
    private int PageSize => PageSettings.UsersPerPageCount;

    protected override async Task OnInitializedAsync() => await LoadAsync(UsersAsync);

    private async Task UsersAsync() => UsersPagination = await UserService.ListAsync(Page, PageSize);

    private async Task PageChanged(int page)
    {
        Page = page;

        await ActionAsync(UsersAsync);
    }
}