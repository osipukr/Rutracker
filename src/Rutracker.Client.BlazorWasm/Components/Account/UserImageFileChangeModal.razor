@inherits PageComponent
@inject IModalService ModalService
@inject IFileReaderService FileReaderService
@inject IUserService UserService

<div class="form">
    <div class="form-group">
        Select image from computer: <input type="file" required accept="image/*" @ref="_inputTypeRef" />
    </div>

    <div class="d-flex flex-row-reverse mt-4">
        <MatButton OnClick="@UpdateClicked" Label="Update" />
        <MatButton OnClick="@CancelClicked" Label="Cancel" />
    </div>
</div>

@code
{
    private ElementReference _inputTypeRef;

    private async Task UpdateClicked()
    {
        var file = (await FileReaderService.CreateReference(_inputTypeRef).EnumerateFilesAsync()).FirstOrDefault();

        await ActionAsync(async () =>
        {
            var url = await UserService.ChangeImageAsync(file);

            ModalService.Close(ModalResult.Ok(url));
        });
    }

    private void CancelClicked() => ModalService.Cancel();
}