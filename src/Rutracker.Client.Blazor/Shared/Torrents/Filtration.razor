@inject AppState AppState
@inject ViewSettings ViewSettings
@inject IMatToaster MatToaster

<div class="mat-layout-grid px-0">
    <div class="mat-layout-grid-inner">
        <div class="mat-layout-grid-cell mat-layout-grid-cell-span-12">
            <EditForm Model="@Model" OnValidSubmit="@OnValidSubmitClicked">
                <DataAnnotationsValidator />

                <MatTextField @bind-Value="@Model.Search"
                              Label="Search"
                              Icon="@MatIconNames.Search"
                              IconTrailing="true"
                              FullWidth="true"
                              InputClass="pr-5"
                              type="search" />

                <ValidationMessage For="@(() => Model.Search)" />

                <MatAccordion Multi="true" class="my-4">
                    <MatExpansionPanel>
                        <MatExpansionPanelSummary class="no-select">
                            <MatExpansionPanelHeader>Size range</MatExpansionPanelHeader>
                        </MatExpansionPanelSummary>

                        <MatExpansionPanelDetails>
                            <div class="d-flex flex-wrap">
                                <div class="flex-fill mx-2">
                                    <MatNumeric Label="From" @bind-Value="@Model.SizeFrom" />
                                    <ValidationMessage For="@(() => Model.SizeFrom)" />
                                </div>

                                <div class="flex-fill mx-2">
                                    <MatNumeric Label="To" @bind-Value="@Model.SizeTo" />
                                    <ValidationMessage For="@(() => Model.SizeTo)" />
                                </div>
                            </div>
                        </MatExpansionPanelDetails>
                    </MatExpansionPanel>
                </MatAccordion>

                <div class="d-flex justify-content-end">
                    <div class="d-flex justify-content-between filter-group-btn">
                        <MatButton @onclick="@ResetButtonClicked"
                                   Label="All"
                                   Disabled="@AppState.SearchInProgress"
                                   Outlined="true"
                                   type="reset"
                                   class="filter-btn mat-elevation-z5" />

                        <MatButton Label="Apply"
                                   Disabled="@AppState.SearchInProgress"
                                   TrailingIcon="@MatIconNames.Search"
                                   Raised="true"
                                   type="submit"
                                   class="filter-btn mat-elevation-z5" />
                    </div>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code
{
    [Parameter] public FilterViewModel Model { get; set; }
    [Parameter] public EventCallback FilterChanged { get; set; }

    private void ResetFiltration()
    {
        Model.Search = null;
        Model.SizeFrom = null;
        Model.SizeTo = null;
    }

    private void ResetButtonClicked()
    {
        ResetFiltration();
        OnValidSubmitClicked();
    }

    private void OnValidSubmitClicked() => FilterChanged.InvokeAsync(EventArgs.Empty);
}