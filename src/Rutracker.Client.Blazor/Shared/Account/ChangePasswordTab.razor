@inject AppState AppState
@inject IMatToaster MatToaster

<MatTab>
    <LabelContent>Changed Password</LabelContent>
    <ChildContent>
        <EditForm Model="@ChangePasswordModel" OnValidSubmit="@ChangePasswordClicked">
            <div class="form-group">
                <DataAnnotationsValidator />
                <ValidationSummary />
            </div>

            <div class="form-group">
                <MatTextField @bind-Value="@ChangePasswordModel.OldPassword"
                              Label="Old password"
                              Icon="@MatIconNames.Lock_open"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true"
                              Type="password" />
            </div>

            <div class="form-group">
                <MatTextField @bind-Value="@ChangePasswordModel.NewPassword"
                              Label="New password"
                              Icon="@MatIconNames.Lock_open"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true"
                              Type="password" />
            </div>

            <div class="form-group">
                <MatTextField @bind-Value="@ChangePasswordModel.ConfirmNewPassword"
                              Label="Confirm new password"
                              Icon="@MatIconNames.Lock_open"
                              IconTrailing="true"
                              FullWidth="true"
                              Required="true"
                              Type="password" />
            </div>

            <div class="form-group mt-4 d-flex justify-content-end">
                <MatButton Type="submit" Raised="true" Label="Change password" />
            </div>
        </EditForm>
    </ChildContent>
</MatTab>

@code
{
    [Parameter] private EventCallback OnChangePassword { get; set; }

    private ChangePasswordViewModel ChangePasswordModel { get; set; } = new ChangePasswordViewModel();

    private async Task ChangePasswordClicked()
    {
        try
        {
            await AppState.ChangePassword(ChangePasswordModel);

            ChangePasswordModel = new ChangePasswordViewModel();

            await OnChangePassword.InvokeAsync(EventArgs.Empty);
        }
        catch (Exception ex)
        {
            MatToaster.Add(ex.Message, MatToastType.Warning, "Password change");
        }
    }
}