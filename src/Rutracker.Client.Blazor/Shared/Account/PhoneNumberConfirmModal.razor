@inject IUserService UserService
@inject IMatToaster MatToaster
@inject IModalService ModalService

<EditForm Model="@ConfirmPhoneNumberModel" OnValidSubmit="@ConfirmPhoneNumberClicked">
    <div class="form-group">
        <DataAnnotationsValidator />
        <ValidationSummary />
    </div>

    <div class="form-group">
        <MatTextField @bind-Value="@ConfirmPhoneNumberModel.Token" Label="Code" FullWidth="true" />
    </div>

    <div class="form-group mt-4 d-flex justify-content-end">
        <MatButton @onclick="@CancelClicked" Raised="true" Label="Cancel" />
        <MatButton Raised="true" Label="Confrim" type="submit" class="ml-2" />
    </div>
</EditForm>

@code
{
    [CascadingParameter] public ModalParameters Parameters { get; set; }

    private ConfirmChangePhoneNumberViewModel ConfirmPhoneNumberModel { get; set; }

    protected override void OnInitialized()
    {
        ConfirmPhoneNumberModel = Parameters.Get<ConfirmChangePhoneNumberViewModel>(nameof(ConfirmChangePhoneNumberViewModel));
    }

    private async Task ConfirmPhoneNumberClicked()
    {
        try
        {
            await UserService.ConfirmChangePhoneNumber(ConfirmPhoneNumberModel);

            MatToaster.Add("The action was successfully confirmed", MatToastType.Success);

            ModalService.Close(ModalResult.Ok(true));
        }
        catch (Exception ex)
        {
            MatToaster.Add(ex.Message, MatToastType.Warning);
        }
    }

    private void CancelClicked() => ModalService.Cancel();
}
