@inject ITorrentService TorrentService

@page "/torrents"

<Page Title="torrent list" Action="@ActionResult" Errors="@Errors">
    <Filtration OnChange="@FilterChanged" />

    <TorrentList Items="@TorrentsPagination.Items" />

    <Pagination Page="@Page"
                PageSize="@PageSize"
                TotalPages="@TorrentsPagination.TotalPages"
                TotalItems="@TorrentsPagination.TotalItems"
                OnPageChange="@PageChanged" />
</Page>

@code
{
    private PaginationResult<TorrentViewModel> TorrentsPagination { get; set; }
    private FilterViewModel FilterModel { get; set; } = new FilterViewModel();
    private int Page { get; set; } = 1;
    private int PageSize => ViewSettings.TorrentsPerPageCount;

    protected override async Task OnInitializedAsync() => await TorrentsAsync();

    private async Task TorrentsAsync() => await LoadAsync(async () => TorrentsPagination = await TorrentService.ListAsync(Page, PageSize, FilterModel));

    private async Task PageChanged(int page)
    {
        Page = page;

        await TorrentsAsync();
    }

    private async Task FilterChanged(FilterViewModel filter)
    {
        FilterModel = filter;

        await PageChanged(1);
    }
}