@layout LoginLayout

@inject IAccountService AccountService
@inject IUriHelper UriHelper
@inject IMatToaster MatToaster

@page "/account/register"

<MatCard>
    <EditForm Model="@RegisterModel" OnValidSubmit="@RegisterClicked">
        <div class="form-group">
            <DataAnnotationsValidator />
            <ValidationSummary />
        </div>

        <div class="form-group">
            <MatTextField @bind-Value="@RegisterModel.UserName"
                          Label="User Name"
                          Icon="@MatIconNames.Person"
                          IconTrailing="true"
                          FullWidth="true"
                          Required="true" />
        </div>

        <div class="form-group">
            <MatTextField @bind-Value="@RegisterModel.Email"
                          Label="Email"
                          Icon="@MatIconNames.Mail_outline"
                          IconTrailing="true"
                          FullWidth="true"
                          Required="true" />
        </div>

        <div class="form-group">
            <MatTextField @bind-Value="@RegisterModel.Password"
                          Label="Password"
                          Icon="@MatIconNames.Lock_open"
                          IconTrailing="true"
                          FullWidth="true"
                          Required="true"
                          Type="password" />
        </div>

        <div class="form-group">
            <MatTextField @bind-Value="@RegisterModel.ConfirmPassword"
                          Label="Password Confirmation"
                          Icon="@MatIconNames.Lock_open"
                          IconTrailing="true"
                          FullWidth="true"
                          Required="true"
                          Type="password" />
        </div>

        <div class="form-group d-flex justify-content-end">
            <MatButton Type="submit" Raised="true" Label="Create account" />
        </div>

        <MatButton Link="@Constants.Path.Login" Outlined="true" Label="Login to account" />
    </EditForm>
</MatCard>

@code
{
    private RegisterViewModel RegisterModel { get; set; } = new RegisterViewModel();

    private async Task RegisterClicked()
    {
        try
        {
            await AccountService.Register(RegisterModel);

            MatToaster.Add("To complete registration, check the email.", MatToastType.Success, "Confirm email");

            UriHelper.NavigateTo(Constants.Path.Login);
        }
        catch (Exception ex)
        {
            MatToaster.Add(ex.Message, MatToastType.Warning, "Creating account");
        }
    }
}