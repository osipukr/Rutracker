@inherits PageComponent
@inject IUserService UserService
@inject IModalService ModalService

<EditForm Model="@ChangeUserModel" OnValidSubmit="@ChangeClicked">
    <div class="form-group">
        <DataAnnotationsValidator />
        <ValidationSummary />
    </div>

    <div class="form-group">
        <MatTextField @bind-Value="@ChangeUserModel.FirstName" Label="Fist Name" FullWidth="true" />
    </div>

    <div class="form-group">
        <MatTextField @bind-Value="@ChangeUserModel.LastName" Label="Last Name" FullWidth="true" />
    </div>

    <div class="form-group mt-4 d-flex justify-content-end">
        <MatButton OnClick="@CancelClicked" Label="Cancel" Raised="true" class="mx-2" />
        <MatButton Label="Update" Raised="true" type="submit" class="mx-2" />
    </div>
</EditForm>

@code
{
    [CascadingParameter] public ModalParameters Parameters { get; set; }

    private ChangeUserViewModel ChangeUserModel { get; set; }

    protected override void OnInitialized() => ChangeUserModel = Parameters.Get<ChangeUserViewModel>(nameof(ChangeUserViewModel));

    private async Task ChangeUserAsync()
    {
        await UserService.ChangeUser(ChangeUserModel);

        MatToaster.Add("User information changed successfully.", MatToastType.Success);

        ModalService.Close(ModalResult.Ok(true));
    }

    private async Task ChangeClicked() => await ActionAsync(ChangeUserAsync);
    private void CancelClicked() => ModalService.Cancel();
}